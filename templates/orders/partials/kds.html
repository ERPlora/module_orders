{% load djicons i18n djicons djicons %}

<!-- Station Tabs -->
<div class="p-4">
    <div class="flex gap-2 overflow-x-auto pb-2 mb-4">
        {% for station in stations %}
        <button type="button"
                hx-get="{% url 'orders:kds_station' station.id %}"
                hx-target="#main-content-area"
                hx-push-url="true"
                class="btn {% if current_station and current_station.id == station.id %}color-primary{% else %}btn-outline{% endif %} whitespace-nowrap">
            {% icon station.icon %}
            {{ station.name }}
            {% if station.pending_count > 0 %}
            <span class="badge color-error badge-sm ml-1">{{ station.pending_count }}</span>
            {% endif %}
        </button>
        {% endfor %}
    </div>

    {% if current_station %}
    <!-- KDS Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
        {% for item in items %}
        <div class="card {% if item.is_delayed %}border-danger{% endif %}">
            <div class="card-header flex items-center justify-between"
                 {% if item.is_delayed %}style="background: var(--color-error); color: white"{% endif %}>
                <div class="flex items-center gap-2">
                    <span class="font-bold">#{{ item.order_number }}</span>
                    {% if item.priority == 'rush' %}
                    <span class="badge color-error badge-sm">{% trans "RUSH" %}</span>
                    {% elif item.priority == 'high' %}
                    <span class="badge color-warning badge-sm">{% trans "HIGH" %}</span>
                    {% endif %}
                </div>
                <div class="flex items-center gap-2 text-sm">
                    <span>{{ item.table }}</span>
                    <span class="{% if item.is_delayed %}font-bold{% else %}opacity-70{% endif %}">{{ item.elapsed_minutes }}{% trans "min" %}</span>
                </div>
            </div>
            <div class="card-body">
                <div class="text-lg font-bold mb-1">{{ item.quantity }}x {{ item.product_name }}</div>
                {% if item.modifiers %}
                <p class="text-sm text-primary mb-1">{{ item.modifiers }}</p>
                {% endif %}
                {% if item.notes %}
                <p class="text-sm text-warning italic">{% icon "alert-circle-outline" css_class="text-xs" %} {{ item.notes }}</p>
                {% endif %}
            </div>
            <div class="card__footer">
                <button type="button" class="btn btn-block color-success"
                        hx-post="{% url 'orders:api_bump_item' item.id %}"
                        hx-swap="none"
                        hx-on::after-request="if(event.detail.successful) htmx.ajax('GET', window.location.href, '#main-content-area')">
                    {% icon "checkmark-outline" %} {% trans "BUMP" %}
                </button>
            </div>
        </div>
        {% empty %}
        <div class="col-span-full p-8 text-center">
            {% icon "checkmark-circle-outline" css_class="text-4xl text-success mb-2" %}
            <p class="text-muted">{% trans "All caught up! No pending items for this station." %}</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- No station selected -->
    <div class="p-12 text-center">
        {% icon "grid-outline" css_class="text-5xl text-muted mb-3" %}
        <p class="text-lg text-muted">{% trans "Select a station to view items" %}</p>
    </div>
    {% endif %}
</div>
