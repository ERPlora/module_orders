{% load i18n djicons %}

<div class="p-4">
    <div class="flex items-center justify-between mb-4">
        <div>
            <h3 class="text-lg font-semibold">{% trans "Order Routing" %}</h3>
            <p class="text-sm text-muted">{% trans "Route products and categories to kitchen stations" %}</p>
        </div>
    </div>

    <!-- Available Stations -->
    {% if stations %}
    <div class="flex gap-2 mb-4 overflow-x-auto pb-2">
        {% for station in stations %}
        <div class="badge badge-lg" style="background: {{ station.color }}20; color: {{ station.color }}; border: 1px solid {{ station.color }}40">
            {% icon station.icon %} {{ station.name }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Product Routing -->
    <div class="card mb-4">
        <div class="card-header">
            <div class="flex items-center justify-between">
                <h3 class="card-title">{% icon "cube-outline" css_class="text-primary" %} {% trans "Product Routing" %}</h3>
                <span class="badge">{{ product_mappings|length }}</span>
            </div>
        </div>
        <div class="list">
            {% for mapping in product_mappings %}
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{{ mapping.product.name|default:mapping.product_id }}</div>
                    <div class="list-item-note">
                        {% icon "arrow-forward-outline" css_class="text-xs" %}
                        <span style="color: {{ mapping.station.color }}">{% icon mapping.station.icon css_class="text-xs" %} {{ mapping.station.name }}</span>
                    </div>
                </div>
                <div class="list-item-end">
                    <button type="button" class="btn btn-sm btn-ghost text-error"
                            hx-post="{% url 'orders:remove_product_routing' mapping.product_id %}"
                            hx-swap="none"
                            hx-confirm="{% trans 'Remove this product routing?' %}"
                            hx-on::after-request="if(event.detail.successful) htmx.ajax('GET', '{% url 'orders:routing' %}', '#main-content-area')">
                        {% icon "close-outline" %}
                    </button>
                </div>
            </div>
            {% empty %}
            <div class="p-6 text-center">
                <p class="text-muted text-sm">{% trans "No product routings. Products will use category routing as fallback." %}</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Category Routing -->
    <div class="card">
        <div class="card-header">
            <div class="flex items-center justify-between">
                <h3 class="card-title">{% icon "folder-outline" css_class="text-warning" %} {% trans "Category Routing" %}</h3>
                <span class="badge">{{ category_mappings|length }}</span>
            </div>
        </div>
        <div class="list">
            {% for mapping in category_mappings %}
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{{ mapping.category.name|default:mapping.category_id }}</div>
                    <div class="list-item-note">
                        {% icon "arrow-forward-outline" css_class="text-xs" %}
                        <span style="color: {{ mapping.station.color }}">{% icon mapping.station.icon css_class="text-xs" %} {{ mapping.station.name }}</span>
                    </div>
                </div>
                <div class="list-item-end">
                    <button type="button" class="btn btn-sm btn-ghost text-error"
                            hx-post="{% url 'orders:remove_category_routing' mapping.category_id %}"
                            hx-swap="none"
                            hx-confirm="{% trans 'Remove this category routing?' %}"
                            hx-on::after-request="if(event.detail.successful) htmx.ajax('GET', '{% url 'orders:routing' %}', '#main-content-area')">
                        {% icon "close-outline" %}
                    </button>
                </div>
            </div>
            {% empty %}
            <div class="p-6 text-center">
                <p class="text-muted text-sm">{% trans "No category routings configured yet." %}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
